(this.webpackJsonpglobal_faciet=this.webpackJsonpglobal_faciet||[]).push([[0],{104:function(e,t,n){},105:function(e,t,n){},106:function(e,t,n){},107:function(e,t,n){},108:function(e,t,n){},109:function(e,t,n){},110:function(e,t,n){},111:function(e,t,n){},112:function(e,t,n){"use strict";n.r(t),n.d(t,"friendListUrl",(function(){return a})),n.d(t,"addFriendUrl",(function(){return c})),n.d(t,"removeFriendUrl",(function(){return u}));var r=n(6),a=r.default+"/api/friends",c=r.default+"/api/friends/add",u=r.default+"/api/friends/remove"},113:function(e,t,n){},114:function(e,t,n){},115:function(e,t,n){},116:function(e,t,n){},117:function(e,t,n){},118:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(57),u=n.n(c),o=n(2),s=(n(64),n(15)),i=n(25),l=n.n(i),f=n(26),d=Object(r.createContext)({socket:l.a.connect(f.a)}),p=n(3),m=n(1),h=n.n(m),v=n(4);n(98);function b(e){var t=e.placeHodler,n=void 0===t?null:t,r=Object(s.a)(e,["placeHodler"]);return a.a.createElement("input",Object.assign({type:"text",className:"authInput",placeholder:n},r))}n(99);var k=n(14);var j=function(e){var t=e.setSocket,n=Object(r.useState)(!1),c=Object(o.a)(n,2),u=c[0],s=c[1],i=Object(r.useState)(""),l=Object(o.a)(i,2),f=l[0],d=l[1],p=Object(r.useState)(""),m=Object(o.a)(p,2),j=m[0],g=m[1],O=Object(r.useState)(""),y=Object(o.a)(O,2),E=y[0],x=y[1],w=Object(r.useState)(""),T=Object(o.a)(w,2),N=T[0],S=T[1],A=Object(r.useState)(""),C=Object(o.a)(A,2),B=C[0],_=C[1],P=Object(r.useState)(""),z=Object(o.a)(P,2),F=z[0],I=z[1],J=Object(r.useState)(!1),G=Object(o.a)(J,2),H=G[0],U=G[1];function q(){return(q=Object(v.a)(h.a.mark((function e(){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(f.length>2&&E.length>2&&j.length>2&&N.length>2&&B.length>2)||H){e.next=14;break}return U(!0),e.next=4,k.default.singup(E,j,f,B,N);case 4:if(!(n=e.sent).err){e.next=10;break}I(n.err),U(!1),e.next=12;break;case 10:return e.next=12,k.default.authorize().then((function(e){console.log(e,"signing up"),t(e)}));case 12:e.next=15;break;case 14:I("\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0434\u043b\u0438\u043d\u043d\u0430 \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u043f\u043e\u043b\u044f 2 \u0441\u0438\u043c\u0432\u043e\u043b\u0430");case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(){return(L=Object(v.a)(h.a.mark((function e(){var n,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(E.length>2&&j.length>2&&!1===H)){e.next=16;break}return U(!0),e.next=4,k.default.signin(E,j);case 4:if((n=e.sent).err){e.next=12;break}return e.next=8,k.default.authorize();case 8:r=e.sent,t(r),e.next=14;break;case 12:I(n.err),U(!1);case 14:e.next=17;break;case 16:I("\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0434\u043b\u0438\u043d\u043d\u0430 \u0447\u0435\u043b\u0435\u043d\u0430 2 \u0441\u0438\u043c\u0432\u043e\u043b\u0430");case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return u?a.a.createElement("div",{className:"auth"},a.a.createElement(b,{placeHodler:"\u041d\u0438\u043a\u043d\u0435\u0439\u043c",name:"email",onChange:function(e){return x(e.target.value)}}),a.a.createElement(b,{placeHodler:"\u041f\u0430\u0440\u043e\u043b\u044c",name:"password",onChange:function(e){return g(e.target.value)}}),a.a.createElement("p",{className:"err"},F),a.a.createElement("button",{className:"signin ".concat(H),onClick:function(){return function(){return L.apply(this,arguments)}()}},"\u0412\u043e\u0439\u0442\u0438"),a.a.createElement("button",{className:"signup ".concat(H),onClick:function(){return s(!1)}},"\u041d\u0435\u0442 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430")):a.a.createElement("div",{className:"auth"},a.a.createElement(b,{placeHodler:"Email",name:"new email",onChange:function(e){return d(e.target.value)}}),a.a.createElement(b,{placeHodler:"\u041d\u0438\u043a\u043d\u0435\u0439\u043c",name:"new nickname",onChange:function(e){return x(e.target.value)}}),a.a.createElement(b,{placeHodler:"\u041f\u0430\u0440\u043e\u043b\u044c",name:"new password",onChange:function(e){return g(e.target.value)}}),a.a.createElement(b,{placeHodler:"SO2 \u043d\u0438\u043a\u043d\u0435\u0439\u043c",onChange:function(e){return _(e.target.value)}}),a.a.createElement(b,{placeHodler:"SO2 id",onChange:function(e){return S(e.target.value)}}),a.a.createElement("p",{className:"err"},F),a.a.createElement("button",{className:"signup ".concat(H),onClick:function(){return function(){return q.apply(this,arguments)}()}},"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"),a.a.createElement("button",{className:"signin ".concat(H),onClick:function(){return s(!0)}},"\u0423\u0436\u0435 \u0435\u0441\u0442\u044c \u0430\u043a\u043a\u0430\u0443\u043d\u0442"))};function g(e){var t=e.path,n=e.setSocket,c=e.children,u=Object(s.a)(e,["path","setSocket","children"]);return Object(r.useContext)(d).socket?a.a.createElement(p.a,Object.assign({path:t},u),c):a.a.createElement(j,{setSocket:n})}var O=n(5);n(104);function y(){return a.a.createElement("div",{className:"preloader"},a.a.createElement("div",{className:"dot first"}),a.a.createElement("div",{className:"dot second"}),a.a.createElement("div",{className:"dot last"}))}n(105);var E=n(8),x=n(9),w=n(6).default,T=w+"/api/user",N=n(18),S=function(){function e(){Object(E.a)(this,e)}return Object(x.a)(e,null,[{key:"GetOwnProfie",value:function(){var e=Object(v.a)(h.a.mark((function e(){var t,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T,{method:"GET",headers:{Authorization:"Bearer "+O.default.getAccessToken()}});case 2:return t=e.sent,e.next=5,t.json();case 5:if(n=e.sent,console.log(n,"get profile"),!n.err){e.next=18;break}return e.next=10,N.default.refreshByErr(n.err);case 10:if(!e.sent){e.next=15;break}this.GetOwnProfie(),e.next=16;break;case 15:return e.abrupt("return",!1);case 16:e.next=19;break;case 18:return e.abrupt("return",n);case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"GetProfileByUsername",value:function(){var e=Object(v.a)(h.a.mark((function e(t){var n,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T+t,{method:"GET",headers:{Authorization:"Bearer "+O.default.getAccessToken()}});case 2:return n=e.sent,e.next=5,n.json();case 5:if(r=e.sent,console.log(r,"get profile by username"),!r.err){e.next=18;break}return e.next=10,N.default.refreshByErr(r.err);case 10:if(!e.sent){e.next=15;break}this.GetProfileByUsername(t),e.next=16;break;case 15:return e.abrupt("return",!1);case 16:e.next=19;break;case 18:return e.abrupt("return",r.user);case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();n(106);function A(){var e=Object(r.useState)({username:"",rating:0,bio:""}),t=Object(o.a)(e,2),n=t[0],c=t[1];return Object(r.useEffect)((function(){S.GetOwnProfie().then((function(e){e&&c(e)}))}),[]),a.a.createElement("div",{className:"userData"},a.a.createElement("div",{className:"avatar"}),a.a.createElement("div",{className:"textData"},a.a.createElement("div",{className:"username"},n.username),a.a.createElement("div",{className:"rating"},n.rating)),a.a.createElement("div",{className:"bio"},n.bio))}n(107);var C=n(6),B=C.default+"/api/party/invite",_=C.default+"/api/party/join",P=C.default+"/api/party/reject",z=C.default+"/api/party/leave",F=C.default+"/api/party/",I=function(){function e(){Object(E.a)(this,e)}return Object(x.a)(e,null,[{key:"sendInvite",value:function(){var e=Object(v.a)(h.a.mark((function e(t){var n,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(B,{method:"POST",headers:{Authorization:"Bearer "+O.default.getAccessToken(),"Content-type":"application/json"},body:JSON.stringify({access_token:O.default.getAccessToken(),username:t})});case 2:return n=e.sent,e.next=5,n.json();case 5:if(r=e.sent,console.log(r,"send invite"),!r.err){e.next=11;break}console.error(r.err),e.next=12;break;case 11:return e.abrupt("return",!0);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"acceptInvite",value:function(){var e=Object(v.a)(h.a.mark((function e(t){var n,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.next=3,fetch(_,{method:"POST",headers:{Authorization:"Bearer "+O.default.getAccessToken(),"Content-type":"application/json"},body:JSON.stringify({access_token:O.default.getAccessToken(),id:t})});case 3:return n=e.sent,e.next=6,n.json();case 6:if(r=e.sent,console.log(r,"accept invite"),!r.err){e.next=12;break}console.error(r.err),e.next=13;break;case 12:return e.abrupt("return",!0);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"rejectInvite",value:function(){var e=Object(v.a)(h.a.mark((function e(t){var n,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.next=3,fetch(P,{method:"POST",headers:{Authorization:"Bearer "+O.default.getAccessToken(),"Content-type":"application/json"},body:JSON.stringify({id:t})});case 3:return n=e.sent,e.next=6,n.json();case 6:if(r=e.sent,console.log(r,"reject invite"),!r.err){e.next=12;break}console.error(r.err),e.next=13;break;case 12:return e.abrupt("return",!0);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"leaveParty",value:function(){var e=Object(v.a)(h.a.mark((function e(){var t,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(z,{method:"POST",headers:{Authorization:"Bearer "+O.default.getAccessToken(),"Content-type":"application/json"},body:JSON.stringify({access_token:O.default.getAccessToken()})});case 2:return t=e.sent,e.next=5,t.json();case 5:if(n=e.sent,console.log(n,"leave party"),!n.err){e.next=12;break}N.default.refreshByErr(n.err)&&this.leaveParty(),e.next=13;break;case 12:return e.abrupt("return",!0);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getParty",value:function(){var e=Object(v.a)(h.a.mark((function e(){var t,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(F,{method:"GET",headers:{Authorization:"Bearer "+O.default.getAccessToken()}});case 2:return t=e.sent,e.next=5,t.json();case 5:if(n=e.sent,console.log(n,"gett party"),!n.err){e.next=11;break}console.error(n.err),e.next=12;break;case 11:return e.abrupt("return",n.data);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}();n(108);function J(e){var t=e.children,n=Object(s.a)(e,["children"]);return a.a.createElement("button",Object.assign({className:"btns cancel"},n),t)}function G(e){var t=e.children,n=Object(s.a)(e,["children"]);return a.a.createElement("button",Object.assign({className:"btns submit"},n),t)}n(109);function H(e){var t=e.show,n=e.children;return a.a.createElement("div",{className:"overlay "+t},n)}function U(){var e=Object(r.useContext)(d).socket,t=Object(r.useState)({players:[]}),n=Object(o.a)(t,2),c=n[0],u=n[1],s=Object(r.useState)(""),i=Object(o.a)(s,2),l=i[0],f=i[1],p=Object(r.useState)(!1),m=Object(o.a)(p,2),h=m[0],v=m[1];return Object(r.useEffect)((function(){return e.on("party",(function(e){console.log(e,"socket party"),u(e.data)})),I.getParty().then((function(e){console.log(e,"fetch party"),u(e)})),function(){e.off("party")}}),[e]),a.a.createElement("div",{className:"party"},a.a.createElement(H,{show:h},a.a.createElement("div",{className:"invite"},a.a.createElement("input",{type:"target",onChange:function(e){return f(e.target.value)},value:l}),a.a.createElement("div",{className:"controls"},a.a.createElement(J,{onClick:function(){return v(!1)}},"\u041e\u0442\u043c\u0435\u043d\u0430"),a.a.createElement(G,{onClick:function(){return v(!1),console.log(l),I.sendInvite(l),void f("")}},"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c")))),c.players.map((function(e){return a.a.createElement("div",{key:e.username,className:"member"},e.username)})),5!==c.players.length?a.a.createElement("div",{className:"addMember member",onClick:function(){return v(!0)}},"\u041f\u0440\u0438\u0433\u043b\u0430\u0441\u0438\u0442\u044c \u0438\u0433\u0440\u043e\u043a\u0430"):"",1!==c.players.length?a.a.createElement("div",{className:"cancel member",onClick:function(){I.leaveParty()}},"\u0412\u044b\u0439\u0442\u0438"):"")}n(110);var q=n(6).default,L=q+"/api/queue/join",M=q+"/api/queue/leave",Q=function(){function e(){Object(E.a)(this,e)}return Object(x.a)(e,null,[{key:"JoinQueue",value:function(){var e=Object(v.a)(h.a.mark((function e(){var t,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(L,{method:"GET",headers:{Authorization:"Bearer "+O.default.getAccessToken(),"Content-type":"application/json"}});case 2:return t=e.sent,e.next=5,t.json();case 5:if(n=e.sent,console.log(n,"join queue"),!n.err){e.next=11;break}return e.abrupt("return",!1);case 11:return e.abrupt("return",!0);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"LeaveQueue",value:function(){var e=Object(v.a)(h.a.mark((function e(){var t,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(M,{method:"GET",headers:{Authorization:"Bearer "+O.default.getAccessToken(),"Content-type":"application/json"}});case 2:return t=e.sent,e.next=5,t.json();case 5:if(n=e.sent,console.log(n,"leave queue"),!n.err){e.next=11;break}return e.abrupt("return",!1);case 11:return e.abrupt("return",!0);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}(),R=1;function D(){var e=Object(r.useContext)(d).socket,t=Object(r.useState)(!1),n=Object(o.a)(t,2),c=n[0],u=n[1],s=Object(r.useState)(""),i=Object(o.a)(s,2),l=i[0],f=i[1];function p(){f("shake"),setTimeout((function(){f("")}),500)}return Object(r.useEffect)((function(){return I.getParty().then((function(e){e.status===R?u(!0):u(!1)})),e.on("queue",(function(e){console.log(e,"search"),e.data?u(!0):u(!1)})),function(){e.off("queue")}}),[e]),a.a.createElement("div",{className:"search"},a.a.createElement("button",{className:(c?"red ":" ")+l,onClick:function(){c?Q.LeaveQueue().then((function(e){return e?u(!1):p()})):Q.JoinQueue().then((function(e){return e?u(!0):p()}))}},c?"\u041e\u0442\u043c\u0435\u043d\u0430":"\u0418\u0441\u043a\u0430\u0442\u044c"))}function W(){return a.a.createElement("div",{className:"matchMaking"},a.a.createElement(A,null),a.a.createElement(D,null),a.a.createElement(U,null))}var V=n(27),$=(n(111),n(119)),K=[{url:"/",name:"MM"},{url:"/friends",name:"Friends"},{url:"/notifications",name:"nots"}];function X(){var e=Object(p.f)();return a.a.createElement("div",{className:"navbar"},K.map((function(t){return a.a.createElement(V.b,{className:e.pathname===t.url?"navLink active":"navLink",to:t.url,key:Object($.a)()},t.name)})))}var Y=n(19),Z=n(112),ee=Z.addFriendUrl,te=Z.removeFriendUrl,ne=Z.friendListUrl,re=n(5).default,ae=n(18).default,ce=function(){function e(){Object(E.a)(this,e)}return Object(x.a)(e,null,[{key:"addFriend",value:function(){var e=Object(v.a)(h.a.mark((function e(t){var n,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(ee,{method:"POST",headers:{Authorization:"Bearer "+re.getAccessToken(),"Content-type":"application/json"},body:JSON.stringify({access_token:re.getAccessToken(),username:t})});case 2:return n=e.sent,e.next=5,n.json();case 5:if(r=e.sent,console.log(r,"add friend"),!r.err){e.next=18;break}return e.next=10,ae.refreshByErr(r.err);case 10:if(!e.sent){e.next=15;break}this.addFriend(t),e.next=16;break;case 15:return e.abrupt("return",!1);case 16:e.next=19;break;case 18:return e.abrupt("return",!0);case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"removeFriend",value:function(){var e=Object(v.a)(h.a.mark((function e(t){var n,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(te,{method:"POST",headers:{Authorization:"Bearer "+re.getAccessToken(),"Content-type":"application/json"},body:JSON.stringify({id:t})});case 2:return n=e.sent,e.next=5,n.json();case 5:if(r=e.sent,console.log(r,"remove friend"),!r.err){e.next=12;break}return console.error(r.err),e.abrupt("return",!1);case 12:return e.abrupt("return",!0);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFriends",value:function(){var e=Object(v.a)(h.a.mark((function e(){var t,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(ne,{method:"GET",headers:{Authorization:"Bearer "+re.getAccessToken()}});case 2:return t=e.sent,e.next=5,t.json();case 5:if(n=e.sent,console.log(n,"get friends"),!n.err){e.next=12;break}return console.error(n.err),e.abrupt("return",!1);case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}();n(113),n(114);function ue(e){var t=e.data,n=e.destroy,r=void 0===n?function(){}:n;return a.a.createElement("div",{className:"friend"},a.a.createElement("div",{className:"data"},a.a.createElement("div",{className:"username"},t.username)),a.a.createElement("div",{className:"controls"},a.a.createElement(J,{onClick:function(){return ce.removeFriend(t.id),void r()}},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"),a.a.createElement(G,{onClick:function(){I.sendInvite(t.username)}},"\u041f\u0440\u0438\u0433\u043b\u0430\u0441\u0438\u0442\u044c")))}function oe(){var e=Object(r.useState)([]),t=Object(o.a)(e,2),n=t[0],c=t[1],u=Object(r.useState)(""),s=Object(o.a)(u,2),i=s[0],l=s[1],f=Object(r.useState)(!1),d=Object(o.a)(f,2),p=d[0],m=d[1];return Object(r.useEffect)((function(){ce.getFriends().then((function(e){e&&(console.log(e[0]),c(e))}))}),[]),a.a.createElement("div",{className:"friends"},a.a.createElement("div",{className:"controls"},a.a.createElement(G,{onClick:function(){return m(!0)}},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c")),a.a.createElement(H,{show:p},a.a.createElement("div",{className:"addFriend"},a.a.createElement("input",{type:"target",onChange:function(e){return l(e.target.value)},value:i}),a.a.createElement("div",{className:"controls"},a.a.createElement(J,{onClick:function(){return m(!1)}},"\u041e\u0442\u043c\u0435\u043d\u0430"),a.a.createElement(G,{onClick:function(){return m(!1),ce.addFriend(i),void l("")}},"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c")))),n.map((function(e,t){return a.a.createElement(ue,{key:e.username,data:e,destroy:function(){return function(e){c((function(t){var n=Object(Y.a)(t);return n.splice(e),n}))}(t)}})})))}n(115);function se(e){var t=e.id,n=e.from,c=e.destroy,u=Object(r.useState)(""),s=Object(o.a)(u,2),i=s[0],l=s[1];return a.a.createElement("div",{className:"notification invite "+i},a.a.createElement("p",null,"\u0418\u043d\u0432\u0430\u0439\u0442 \u043e\u0442 ",n),a.a.createElement("div",{className:"controls"},a.a.createElement(J,{onClick:function(){return function(e){l("remove"),setTimeout((function(){c()}),340),I.rejectInvite(e)}(t)}},"\u041e\u0442\u043c\u0435\u043d\u0430"),a.a.createElement(G,{onClick:function(){return function(e){l("remove"),setTimeout((function(){c()}),340),I.acceptInvite(e)}(t)}},"\u041f\u0440\u0438\u043d\u044f\u0442\u044c")))}function ie(e){var t=e.from,n=e.destroy,c=Object(r.useState)(""),u=Object(o.a)(c,2),s=u[0],i=u[1];return a.a.createElement("div",{className:"notification invite "+s},a.a.createElement("p",null,"\u041f\u0440\u0438\u0433\u043b\u0430\u0448\u0435\u043d\u0438\u0435 \u0432 \u0434\u0440\u0443\u0437\u044c\u044f \u043e\u0442 ",t.username),a.a.createElement("div",{className:"controls"},a.a.createElement(J,{onClick:function(){return t.username,i("remove"),void setTimeout((function(){n()}),340)}},"\u041e\u0442\u043c\u0435\u043d\u0430"),a.a.createElement(G,{onClick:function(){return e=t.username,i("remove"),setTimeout((function(){n()}),340),void ce.addFriend(e);var e}},"\u041f\u0440\u0438\u043d\u044f\u0442\u044c")))}n(116);function le(){var e=Object(r.useContext)(d).socket,t=Object(r.useState)([]),n=Object(o.a)(t,2),c=n[0],u=n[1];return Object(r.useEffect)((function(){var t=function(e){u((function(t){var n=Object(Y.a)(t);return n.splice(e,1),n}))};return e&&e.on("notification",(function(e){switch(console.log(e),e.type){case"party/invite":u((function(n){return[].concat(Object(Y.a)(n),[a.a.createElement(se,{id:e.data.id,from:e.data.players[0].username,key:Object($.a)(),destroy:function(){return t(n.length)}})])}));break;case"friends/add":u((function(n){return[].concat(Object(Y.a)(n),[a.a.createElement(ie,{from:e.data,key:Object($.a)(),destroy:function(){return t(n.length)}})])}))}})),function(){e&&e.off("notification")}}),[e]),a.a.createElement("div",{className:"notifications"},c)}var fe=n(37),de=C.default+"/api/notifications",pe=function(){function e(){Object(E.a)(this,e)}return Object(x.a)(e,null,[{key:"get",value:function(){var e=Object(v.a)(h.a.mark((function e(){var t,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(de,{method:"GET",headers:{Authorization:"Bearer "+O.default.getAccessToken()}});case 2:return t=e.sent,e.next=5,t.json();case 5:if(n=e.sent,console.log(n,"get notifications"),!n.err){e.next=12;break}return console.error(n.err),e.abrupt("return",!1);case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}();n(117);function me(){var e=Object(r.useState)({party:[],friends:[]}),t=Object(o.a)(e,2),n=t[0],c=t[1];return Object(r.useEffect)((function(){pe.get().then((function(e){e&&c(e)}))}),[]),a.a.createElement("div",{className:"notificationsView"},n.friends.map((function(e,t){return a.a.createElement(ie,{from:e.username,destroy:function(){return function(e){c((function(t){var n=Object(fe.a)({},t);return n.friends.splice(e,1),n}))}(t)}})})),n.party.map((function(e,t){return a.a.createElement(se,{from:e.players[0].username,id:e.id,destroy:function(){return function(e){c((function(t){var n=Object(fe.a)({},t);return n.party.splice(e,1),n}))}(t)}})})))}var he=function(){var e=Object(r.useState)(null),t=Object(o.a)(e,2),n=t[0],c=t[1],u=Object(r.useState)(!0),s=Object(o.a)(u,2),i=s[0],l=s[1];return Object(r.useEffect)((function(){O.default.getAccessToken()?k.default.authorize().then((function(e){e.on("connect",(function(){return console.log("connected")})),e.on("disconnect",(function(){console.log("disconnected"),l(!1)})),e.on("auth",(function(){console.log("authed"),c(e),l(!1)})),e.on("unauth",(function(){console.log("unauth"),l(!1)}))})):l(!1)}),[]),i?a.a.createElement(y,null):n?a.a.createElement("div",{className:"App"},a.a.createElement(d.Provider,{value:{socket:n}},a.a.createElement(V.a,null,a.a.createElement(le,null),a.a.createElement(p.c,null,a.a.createElement(g,{path:"/",setSocket:c,exact:!0},a.a.createElement(W,null)),a.a.createElement(g,{path:"/friends",setSocket:c,exact:!0},a.a.createElement(oe,null)),a.a.createElement(g,{path:"/notifications",setSocket:c,exact:!0},a.a.createElement(me,null)),a.a.createElement(p.a,{path:"/auth"},a.a.createElement(j,{setSocket:c}))),a.a.createElement(X,null)))):(console.log("not auhed"),a.a.createElement("div",{className:"App"},a.a.createElement(j,{setSocket:c})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(he,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},14:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),c=n(4),u=n(8),o=n(9),s=n(6),i=s.default+"/api/auth/signup",l=s.default+"/api/auth/signin",f=(s.default,s.default+"/api/auth/refresh"),d=n(25),p=n.n(d),m=n(26),h=n(5),v=function(){function e(){Object(u.a)(this,e)}return Object(o.a)(e,null,[{key:"singup",value:function(){var e=Object(c.a)(a.a.mark((function e(t,n,r,c,u){var o,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(i,{method:"POST",headers:{Authorization:"Bearer "+h.default.getAccessToken(),"Content-Type":"application/json"},body:JSON.stringify({username:t,password:n,email:r,so2_nickname:c,so2_id:u})});case 2:return o=e.sent,e.next=5,o.json();case 5:if(s=e.sent,console.log(s),!s.err){e.next=11;break}return e.abrupt("return",{err:s.err});case 11:return console.log(s.access_token),h.default.setAccessToken(s.access_token),e.abrupt("return",{refreshToken:s.refresh_token,access_token:s.access_token});case 14:case"end":return e.stop()}}),e)})));return function(t,n,r,a,c){return e.apply(this,arguments)}}()},{key:"signin",value:function(){var e=Object(c.a)(a.a.mark((function e(t,n){var r,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(l,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+h.default.getAccessToken()},body:JSON.stringify({username:t,password:n})});case 2:return r=e.sent,e.next=5,r.json();case 5:if(c=e.sent,console.log(c),!c.err){e.next=11;break}return e.abrupt("return",{err:c.err});case 11:return h.default.setAccessToken(c.access_token),e.abrupt("return",{refreshToken:c.refreshToken,accessToken:c.access_token});case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"authorize",value:function(){var e=Object(c.a)(a.a.mark((function e(){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=p.a.connect(m.a,{query:{token:h.default.getAccessToken()},secure:!0}),e.abrupt("return",t);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshAccessToken",value:function(){var e=Object(c.a)(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(f,{method:"POST",headers:{Authorization:"Bearer "+t,"Content-Type":"application/json"},body:JSON.stringify({refresh_token:t})});case 2:return n=e.sent,e.next=5,n.json();case 5:if(!(r=e.sent).err){e.next=10;break}return e.abrupt("return",{err:r.err});case 10:return e.abrupt("return",{access_token:r.access_token,refresh_token:r.refresh_token});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}();t.default=v},18:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),c=n(4),u=n(8),o=n(9),s=n(14).default,i=n(5).default,l=function(){function e(){Object(u.a)(this,e)}return Object(o.a)(e,null,[{key:"refreshByErr",value:function(){var e=Object(c.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("jwt expired"!==t.name){e.next=13;break}return e.next=3,s.refreshAccessToken(i.getRefreshToken());case 3:if(!(n=e.sent).err){e.next=9;break}return i.clear(),e.abrupt("return",!1);case 9:return i.setAccessToken(n.access_token),e.abrupt("return",n.access_token);case 11:e.next=14;break;case 13:return e.abrupt("return",!1);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}();t.default=l},26:function(e,t,n){"use strict";t.a="https://totalifydev.tk"},5:function(e,t,n){"use strict";n.r(t);var r=n(8),a=n(9),c=function(){function e(){Object(r.a)(this,e)}return Object(a.a)(e,null,[{key:"getRefreshToken",value:function(){return localStorage.getItem("refreshToken")}},{key:"getAccessToken",value:function(){return localStorage.getItem("accessToken")}},{key:"setRefreshToken",value:function(e){return localStorage.setItem("refreshToken",e)}},{key:"setAccessToken",value:function(e){return localStorage.setItem("accessToken",e)}},{key:"clear",value:function(){localStorage.clear()}}]),e}();t.default=c},59:function(e,t,n){e.exports=n(118)},6:function(e,t,n){"use strict";n.r(t);t.default="https://totalifydev.tk"},64:function(e,t,n){},94:function(e,t){},98:function(e,t,n){},99:function(e,t,n){}},[[59,1,2]]]);
//# sourceMappingURL=main.6f7ec051.chunk.js.map